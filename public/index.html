
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Component Life EM</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <style>
    .tab-content { margin-top: 20px; }
    .table th, .table td { vertical-align: middle; text-align: center; }
    .form-popup { display: none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%); background: #fff; padding: 20px; border: 1px solid #ccc; z-index: 1000; width: 90%; max-width: 600px; }
    .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
    .input-bar { display: flex; gap: 10px; margin-top: 20px; align-items: center; flex-wrap: wrap; }
    .input-bar input { flex: 1; min-width: 150px; }
    .input-bar button { white-space: nowrap; }
    textarea { font-family: monospace; white-space: pre; }
  </style>
</head>
<body class="container py-4">
  <h2>Component Life EM</h2>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="mainTabs">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#compLife">Comp-Life</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#updateSMU">Update Current SMU</a></li>
  </ul>

  <div class="tab-content">
    <!-- Comp-Life Tab -->
    <div class="tab-pane fade show active" id="compLife">
      <div class="input-bar">
        <input class="form-control" placeholder="Equip" />
        <input class="form-control" placeholder="Model" />
        <input class="form-control" placeholder="Component" />
        <button class="btn btn-primary" onclick="openForm()">Add New</button>
      </div>
      <table class="table table-bordered table-striped mt-3">
        <thead>
          <tr>
            <th>Equip</th><th>Model</th><th>Component</th><th>Freq</th><th>Cost</th><th>Change Out</th>
            <th>Next Change</th><th>Current SMU</th><th>Life</th><th>Life %</th><th>Rating</th><th>Remarks</th><th>Foto</th><th>Action</th>
          </tr>
        </thead>
        <tbody id="dataTable"></tbody>
      </table>
    </div>

    <!-- Update Current SMU Tab -->
    <div class="tab-pane fade" id="updateSMU">
      <h4 class="mt-3">Update Current SMU (Massal)</h4>
      <p>Silakan paste data dari Excel (kolom Equipment dan Current SMU, dipisah tab):</p>
      <textarea id="inputSMU" class="form-control mb-3" rows="5" placeholder="Contoh:
C02060	17506
C02072	67719"></textarea>
      <div class="row mb-3">
        <div class="col-md-4"><input type="text" class="form-control" id="filterEquip" placeholder="Filter Equip" oninput="filterSMUTable()" /></div>
        <div class="col-md-4"><input type="text" class="form-control" id="filterModel" placeholder="Filter Model" oninput="filterSMUTable()" /></div>
        <div class="col-md-4"><input type="text" class="form-control" id="filterComponent" placeholder="Filter Component" oninput="filterSMUTable()" /></div>
      </div>
      <div class="mb-3">
        <button class="btn btn-primary" onclick="tampilkanTabel()">Tampilkan Tabel</button>
        <button class="btn btn-success" onclick="updateFirebase()">Update Semua ke Firebase</button>
      </div>
      <table class="table table-bordered table-smu">
        <thead>
          <tr><th>Equipment</th><th>Current SMU</th></tr>
        </thead>
        <tbody id="smuTableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Overlay & Form Popup -->
  <div class="overlay" onclick="closeForm()"></div>
  <div class="form-popup" id="formPopup">
    <h5>Add New Component</h5>
    <form id="addForm">
      <div class="row">
        <div class="col-md-6"><input class="form-control mb-2" name="equip" placeholder="Equip" required /></div>
        <div class="col-md-6"><input class="form-control mb-2" name="model" placeholder="Model" required /></div>
        <div class="col-md-6"><input class="form-control mb-2" name="component" placeholder="Component" required /></div>
        <div class="col-md-6"><input class="form-control mb-2" name="freq" type="number" placeholder="Freq" required /></div>
        <div class="col-md-6"><input class="form-control mb-2" name="cost" type="number" placeholder="Cost" required /></div>
        <div class="col-md-6"><input class="form-control mb-2" name="changeOut" type="number" placeholder="Change Out" required /></div>
        <div class="col-md-6"><input class="form-control mb-2" name="rating" placeholder="Rating" /></div>
        <div class="col-md-6"><input class="form-control mb-2" name="remarks" placeholder="Remarks" /></div>
        <div class="col-md-12"><input class="form-control mb-2" name="foto" type="file" accept="image/*" /></div>
      </div>
      <button type="submit" class="btn btn-success">Save</button>
      <button type="button" class="btn btn-secondary" onclick="closeForm()">Cancel</button>
    </form>
  </div>

  <script>
    const currentSMU = { "C02060": 17506, "C02072": 67719 };
    let smuData = [];

    function openForm() {
      document.querySelector('.overlay').style.display = 'block';
      document.querySelector('.form-popup').style.display = 'block';
    }

    function closeForm() {
      document.querySelector('.overlay').style.display = 'none';
      document.querySelector('.form-popup').style.display = 'none';
    }

    document.getElementById('addForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const form = e.target;
      const equip = form.equip.value;
      const model = form.model.value;
      const component = form.component.value;
      const freq = parseFloat(form.freq.value);
      const cost = parseFloat(form.cost.value);
      const changeOut = parseFloat(form.changeOut.value);
      const rating = form.rating.value;
      const remarks = form.remarks.value;
      const foto = form.foto.files[0]?.name || '';

      const current = currentSMU[equip] || 0;
      const nextChange = changeOut + freq;
      const life = current - changeOut;
      const lifePercent = ((life / freq) * 100).toFixed(1);

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${equip}</td><td>${model}</td><td>${component}</td><td>${freq}</td><td>${cost}</td><td>${changeOut}</td>
        <td>${nextChange}</td><td>${current}</td><td>${life}</td><td>${lifePercent}%</td><td>${rating}</td><td>${remarks}</td>
        <td>${foto}</td>
        <td>
          <button class="btn btn-sm btn-warning" onclick="editRow(this)">Edit</button>
          <button class="btn btn-sm btn-success" onclick="saveRow(this)">Save</button>
        </td>
      `;
      document.getElementById('dataTable').appendChild(row);
      closeForm();
      form.reset();
    });

    function editRow(btn) {
      const row = btn.closest('tr');
      [...row.children].forEach((cell, i) => {
        if (i < 13) {
          const val = cell.innerText;
          cell.innerHTML = `<input class="form-control form-control-sm" value="${val.replace('%','')}" />`;
        }
      });
    }

    function saveRow(btn) {
      const row = btn.closest('tr');
      [...row.children].forEach((cell, i) => {
        if (i < 13) {
          const input = cell.querySelector('input');
          if (input) cell.innerText = i === 9 ? `${input.value}%` : input.value;
        }
      });
    }

    function tampilkanTabel() {
      const input = document.getElementById('inputSMU').value.trim();
      const lines = input.split('\n');
      const tbody = document.getElementById('smuTableBody');
      tbody.innerHTML = '';
      smuData = [];

      lines.forEach(line => {
        const [equip, smu] = line.split('\t');
        if (equip && smu && !isNaN(smu)) {
          smuData.push({ equip: equip.trim(), smu: parseInt(smu.trim()) });
          const row = `<tr><td>${equip.trim()}</td><td>${smu.trim()}</td></tr>`;
          tbody.insertAdjacentHTML('beforeend', row);
        }
      });
    }

    function updateFirebase() {
      console.log("Data yang akan diupdate ke Firebase:", smuData);
      alert("Data berhasil disiapkan untuk update ke Firebase (simulasi).");
    }

    function filterSMUTable() {
      const equipVal = document.getElementById('filterEquip').value.toLowerCase();
      const modelVal = document.getElementById('filterModel').value.toLowerCase();
      const compVal = document.getElementById('filterComponent').value.toLowerCase();

      const rows = document.querySelectorAll('#smuTableBody tr');
      rows.forEach(row => {
        const equipText = row.children[0].textContent.toLowerCase();
        const modelText = ''; // Tambahkan jika ada data Model
        const compText = '';  // Tambahkan jika ada data Component

        const matchEquip = equipText.includes(equipVal);
        const matchModel = modelText.includes(modelVal);
        const matchComp = compText.includes(compVal);

        row.style.display = (matchEquip && matchModel && matchComp) ? '' : 'none';
      });
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
